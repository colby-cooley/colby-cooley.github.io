---
title: "Traffic Stops"
description: |
  Analysis of traffic stops in various U.S. locations
author: Colby Cooley
date: December 1, 2025
format: html
execute: 
  warning: false
  message: false
---

Traffic stop data offer important insights into how policing practices vary across time and demographic groups. In this project, I investigate whether search behavior varies by time of day and driver race across three distinct jurisdictions in the Stanford Open Policing Project database: Arizona Statewide, Oakland (CA), and Saint Paul (MN).

```{r}
con_traffic <- DBI::dbConnect(

  RMariaDB::MariaDB(),

  dbname = "traffic",

  host = Sys.getenv("TRAFFIC_HOST"),

  user = Sys.getenv("TRAFFIC_USER"),

  password = Sys.getenv("TRAFFIC_PWD")

)
```

To address this question, I will attempt to combine three separate SQL tables into a unified dataset. I will then try to visualize the resulting search patterns to explore whether certain racial groups experience higher search rates during specific hours of the day.

The following table combines the data from all three tables into one, big table. It groups the data by the hour of the day and by the race of the driver. It also gives the number of stops, number of searches, and percentage of stops that were searches for each of these groups.
```{sql connection=con_traffic, output.var="hourly"}
SELECT
  hour,
  subject_race,
  n_stops,
  n_searched,
  ROUND(100.0 * n_searched / n_stops, 2) AS pct_searched
FROM (
    SELECT
      CONVERT(TIME_FORMAT(time, '%H'), UNSIGNED) AS hour,
      subject_race,
      COUNT(*) AS n_stops,
      SUM(search_conducted) AS n_searched
    FROM (
        SELECT time, subject_race, search_conducted
        FROM az_statewide_2020_04_01

        UNION ALL

        SELECT time, subject_race, search_conducted
        FROM ca_oakland_2020_04_01

        UNION ALL

        SELECT time, subject_race, search_conducted
        FROM mn_saint_paul_2020_04_01
    ) AS combined
    WHERE subject_race IS NOT NULL
      AND TIME_FORMAT(time, '%H') IS NOT NULL
    GROUP BY hour, subject_race
    HAVING COUNT(*) > 1000
) AS hourly
ORDER BY hour, subject_race
```
```{r}
hourly
```

The following plot shows clear differences in stop frequency across hours of the day. Traffic stops increase substantially during daylight hours and decline late at night. Racial groups follow broadly similar patterns, though some groups appear to have disproportionately more stops during certain hours.
```{r}
library(tidyverse)

ggplot(hourly, aes(x = hour, y = n_stops, color = subject_race)) +
geom_line(size = 1) +
labs(
title = "Number of Traffic Stops by Hour and Race",
x = "Hour of Day (0–23)",
y = "Number of Stops",
color = "Driver Race"
) +
theme_minimal()
```

The following figure illustrates how search likelihood varies across the day and across racial groups. Certain groups show consistently higher search rates than others, even during hours where the number of stops is low.
```{r}
ggplot(hourly, aes(x = hour, y = pct_searched, color = subject_race)) +
geom_line(size = 1) +
labs(
title = "Search Rate by Hour and Driver Race",
x = "Hour of Day (0–23)",
y = "Percent of Stops That Resulted in a Search",
color = "Driver Race"
) +
theme_minimal()
```

This analysis reveals that both stop frequency and search rates vary substantially across time of day and across racial groups. Stops are most common in daytime and early evening hours, but search rates do not always follow this pattern. Instead, some racial groups experience higher search rates consistently throughout the day.

References:
- Pierson, E., Simoiu, C., Overgoor, J., Corbett-Davies, S., Ramachandran, V., Phillips, C., Shroff, R., & Goel, S. (2020). **A large-scale analysis of racial disparities in police stops across the United States.** *Nature Human Behaviour.* [https://www.nature.com/articles/s41562-020-0858-1](https://www.nature.com/articles/s41562-020-0858-1)

- Stanford Open Policing Project. (n.d.). **Data portal.** [https://openpolicing.stanford.edu/data/](https://openpolicing.stanford.edu/data/)